sudo: required

env:
  global:
  # AWS_ACCESS_KEY_ID
  - secure: "ErZwMe25mMXxcMBsX+rtIv8wcbncXHHcmjYzNqEpnuWCmGyJgn01yQX4TMh7pXH9AUJa2fmUHXsSQE/wgx6Yp2GwOtZ5P8sc4Rtr/SKj3xWuaEXQcsM8hNW7orFx3oqSh4z1d1DMAxCV7yp633vK5Idj6j18+C/SyarB5iCWLF4gCknuuZQjDeqEep8MhdViqtUTtl4jDZ/15a+XVf/8TSVRyWAZk6jslaSXWeRVUkd+3pM+kZV7VXSFCcRos7drp/OkZPbLMSlzbOE9kllni1KELPTN43zwtI2lxP1DdH5Ey/V4sSyshN4VutymtrNJqRV3fpuOaDuyncyaGHC6sNg/tdxKf3sh0+Jkz1k09o/VQPRAHLkxVeWOChkEkUBeDKM5OmMdVrDMVeIqflKwBEfrhO70wYRXqfu8SinmJBU63tle86wZW1VICNkMc8AN77REy7vAfC/eJ8ijPIgwMzk/5z5RNXy/BzqKiCCrJKSxEEHr9cvx4QNuP+vAufOpNR8g/Ft/839usYRSb++rQRMTTuO7rtPMq5jE+6brHWvBReZsGzheqkR66MW1tEahNDT2jPDQ065tIVMV9Id8wS9Ascx5iz6Cq5Pbc5RB22yfCTNlToktQF4gUy6KqFEzgze7wcIz+D8lr7/XPNapu2i8bBuaoLu1PaIItamZtZ8="
  # AWS_SECRET_ACCESS_KEY
  - secure: "JI0TSF6mGj4Of2Td3joMdySpQN/OtlN0mGK3UCsKzaXzkhOoZJAZfQv/V5Z4UIzwlv71I82Ynl0OqW/n9Sk+JP+QCqq9aW4+wwtZ+phnvkxusQbvGJ/rgd8fmCJj9d37qozcf5v6yyiU27IUy+hq1ziPKL1vckk1XyPlLFRiVYs1ePD0xw8fi0R+60V5ioTaQKU2PElLAPuGDyVF79valQo27BdbbwuKMSu/zU+s+IUONE/zLjxP66bbTHT5EiC7rR//RLQNye9dA+XVIcEyjTpAXkyft3gP6PKQYcuIhdjKHm4Sl/CcC2yINahKUkels2X9w4KcAs9/2XQmfdi5sE+DnicjK5v1mHoMNyxXYCQ0rQ9JedzEGnngoCydsZyA/Dc9DKNR3QqvpuEtlb0U6X60xmS/j1tLzWEBvYCfLXcgV8iBWbtStfo9Z8qKDNTVm4jRXF+Od+fDzHYfE8bYz91mySG8pUsNOSeoSXpuQej9WRlUiEYBb4Yox9J3Tajd0a6Mq1fcWsjL9WlRM7pB+ExZH1bof++iXNOp2C39YhxZUOtKH8C90dM2xICGV91t1Xd7vRaEhddbscN912ab+odukYdHE0b4V7RuKcfBEChjoEW+9mq+5LjrBhynnUC7DfNUs63OMV7Xwc6SDfA0cJpYPA2aGysDULDd7YpCj4M="

jobs:
  include:
    - language: java
      jdk: openjdk11
      services:
        - docker
      cache:
        directories:
          - $HOME/.m2
      install:
        - git clone https://github.com/Opetushallitus/ci-tools.git
        - source ci-tools/common/setup-tools.sh
        - export ARTIFACT_NAME="valintaperusteet-ui"
      script: >-
        ./bin/run-spotless-in-travis.sh &&
        mvn clean package -B -Dbranch=${TRAVIS_BRANCH} -Drevision=${TRAVIS_COMMIT} -DbuildNumber=${TRAVIS_BUILD_NUMBER} &&
        mv target/valintaperusteet-ui-*allinone.jar $DOCKER_BUILD_DIR/artifact/${ARTIFACT_NAME}.jar &&
        cp -vr src/main/resources/oph-configuration $DOCKER_BUILD_DIR/config/ &&
        export BASE_IMAGE="baseimage-fatjar-openjdk11:master" &&
        ./ci-tools/common/pull-image.sh &&
        ./ci-tools/build/build-fatjar.sh $ARTIFACT_NAME
      deploy:
        - provider: script
          script: ./ci-tools/build/upload-image.sh $ARTIFACT_NAME
          on:
            all_branches: true
    - language: node_js
      node_js: 10
      install:
        - npm install
      script:
        - ./bin/run-eslint-in-travis.sh

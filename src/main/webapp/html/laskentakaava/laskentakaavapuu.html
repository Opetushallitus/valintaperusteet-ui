

<!-- kaava root needed for drag & drop -->
<div class="gradingformula dd" style="width:60%;float:left;">
    
    <div class="frame">
        <span class="icon">&#8302;</span>
        <span class="label"><span class="bold">{{model.laskentakaavapuu.nimi}}</span></span>
    </div>
    
    <!-- piirretään laskentakaavapuu, oletetaan että kaavan sisältö ei voi olla pelkästään yksi laskentakaavaviite -->
    <ul class="frame-content">
        <li class="item" ng-repeat="funktiowrapper in model.laskentakaavapuu.funktiokutsu.funktioargumentit">
                <div ng-include="'node'"></div>
        </li>
    </ul>
</div>



<!-- template jota käytetään kaikkien funktioiden piirtämiseen -->
<script type="text/ng-template" id="node">
    
    <!-- piirretään laskentakaavan node jossa ollaan -->
    <div ng-if="funktiowrapper.funktiokutsuChild" ng-include="'template_selector'" ng-init="funktio = funktiowrapper.funktiokutsuChild; laskentakaavaviite = funktiowrapper.laskentakaavaChild"></div>


    <!-- käydään rekursiivisesti nykyisen funktion lapset läpi -->
    <ul ng-if="funktiowrapper.funktiokutsuChild.funktioargumentit" ng-init="parent = funktiowrapper">
        <li ng-if="funktiowrapper.funktiokutsuChild" class="item" ng-repeat="funktiowrapper in parent.funktiokutsuChild.funktioargumentit">
            <div ng-include="'node'"></div>
        </li>
    </ul>
</script>



<!-- Valitaan funktion nimen perusteella, mitä templatea piirtämiseen käytetään -->
<script type="text/ng-template" id="template_selector">
    <div ng-if="funktio.funktionimi == 'LUKUARVO'" ng-include="'lukuarvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'TOTUUSARVO'" ng-include="'totuusarvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'HAKUTOIVE'" ng-include="'hakutoive.html'"></div>
    <div ng-if="funktio.funktionimi == 'DEMOGRAFIA'" ng-include="'demografia.html'"></div>

    <div ng-if="funktio.funktionimi == 'HAETOTUUSARVO'" ng-include="'haettava_arvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'HAELUKUARVO'" ng-include="'haettava_arvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'HAEMERKKIJONOJAKONVERTOILUKUARVOKSI'" ng-include="'haettava_arvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'HAEMERKKIJONOJAVERTAAYHTASUURUUS'" ng-include="'haettava_arvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'HAEMERKKIJONOJAKONVERTOITOTUUSARVOKSI'" ng-include="'haettava_arvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'VALINTAPERUSTEYHTASUURUUS'" ng-include="'haettava_arvo.html'"></div>

    <div ng-if="funktio.funktionimi == 'SUMMA'" ng-include="'summa.html'"></div>

    <div ng-if="funktio.funktionimi == 'TAI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'TULO'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'JOS'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'OSAMAARA'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'SUUREMPI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'YHTASUURI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'PIENEMPI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'MEDIAANI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'PIENEMPITAIYHTASUURI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'SUUREMPITAIYHTASUURI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'EI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'JA'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'MAKSIMI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'MINIMI'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'NEGAATIO'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'KESKIARVO'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'PAINOTETTUKESKIARVO'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'KONVERTOILUKUARVO'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'HYLKAA'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'PYORISTYS'" ng-include="'funktio.html'"></div>
    <div ng-if="funktio.funktionimi == 'SKAALAUS'" ng-include="'funktio.html'"></div>

    <div ng-if="funktio.funktionimi == 'NMINIMI'" ng-include="'fargumentticount_funktio_handle.html'"></div>
    <div ng-if="funktio.funktionimi == 'NMAKSIMI'" ng-include="'fargumentticount_funktio_handle.html'"></div>
    <div ng-if="funktio.funktionimi == 'KESKIARVONPARASTA'" ng-include="'fargumentticount_funktio_handle.html'"></div>
    <div ng-if="funktio.funktionimi == 'SUMMANPARASTA'" ng-include="'fargumentticount_funktio_handle.html'"></div>

    <div ng-if="funktio.funktionimi == 'HYLKAAARVOVALILLA'" ng-include="'hylkaa_arvovalilla.html'"></div>

    <div ng-if="funktio.funktionimi == 'NIMETTYLUKUARVO'" ng-include="'nimetty_lukuarvo.html'"></div>
    <div ng-if="funktio.funktionimi == 'NIMETTYTOTUUSARVO'" ng-include="'nimetty_totuusarvo.html'"></div>

</script>

<!-- Laskentakaavaviite-->
<script type="text/ng-template" id="subformula.html">
    <div class="frame" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, false)">{{funktio.nimi}}</span>
    </div>
</script>


<!--
    HAETOTUUSARVO
    HAELUKUARVO
    HAEMERKKIJONOJAKONVERTOILUKUARVOKSI
    HAEMERKKIJONOJAVERTAAYHTASUURUUS
    HAEMERKKIJONOJAKONVERTOITOTUUSARVOKSI
    HAEMERKKIJONOJAKONVERTOITOTUUSARVOKSI
    VALINTAPERUSTEYHTASUURUUS
 -->
<script type="text/ng-template" id="haettava_arvo.html">
    <div class="parameter" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, true)">
            <span ng-if="funktio.valintaperusteviitteet[0].lahde == 'HAETTAVA_ARVO'">Arvo hakemukselta</span> 
            <span ng-if="funktio.valintaperusteviitteet[0].lahde == 'SYOTETTAVA_ARVO'">Syötettävä arvo</span> 
            <span ng-if="funktio.valintaperusteviitteet[0].lahde == 'HAKUKOHTEEN_ARVO'">Hakukohteen arvo</span> 
            <span ng-if="funktio.valintaperusteviitteet[0].tunniste">({{funktio.valintaperusteviitteet[0].tunniste}})</span>
            <span ng-if="funktio.valintaperusteviitteet[0].kuvaus">- {{funktio.valintaperusteviitteet[0].kuvaus}}</span>
        </span>
    </div>
</script>


<!--
    N MINIMI 
    N MAKSIMI
    N PARASTA KESKIARVO
    SUMMA N PARASTA 
-->
<script type="text/ng-template" id="fargumentticount_funktio_handle.html">

    <div class="function" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span ng-if="!funktio.syoteparametrit[0].arvo" class="label" ng-click="kaavaInformationView(funktio, true)">
            <span ng-if="funktio.funktionimi == 'NMINIMI'">N huonoin</span>
            <span ng-if="funktio.funktionimi == 'NMAKSIMI'">N paras</span>
            <span ng-if="funktio.funktionimi == 'KESKIARVONPARASTA'">N:n suurimman keskiarvo</span>
            <span ng-if="funktio.funktionimi == 'SUMMANPARASTA'">N:n suurimman summa</span>
        </span>
        <span ng-if="funktio.syoteparametrit[0].arvo" ng-click="kaavaInformationView(funktio, true)" class="label">
            <span ng-if="funktio.funktionimi == 'NMINIMI'">{{funktio.syoteparametrit[0].arvo}} huonoin</span>
            <span ng-if="funktio.funktionimi == 'NMAKSIMI'">{{funktio.syoteparametrit[0].arvo}} paras</span>
            <span ng-if="funktio.funktionimi == 'KESKIARVONPARASTA'">{{funktio.syoteparametrit[0].arvo}} suurimman keskiarvo</span>
            <span ng-if="funktio.funktionimi == 'SUMMANPARASTA'">{{funktio.syoteparametrit[0].arvo}} suurimman summa</span>

        </span>
    </div>
</script>


<!-- NIMETTY LUKUARVO -->
<script type="text/ng-template" id="nimetty_lukuarvo.html">
    <div class="frame">
        <span class="icon">&#8302;</span>
        <span class="label"
              ng-click="kaavaInformationView(funktio, true)">{{funktio.syoteparametrit[0].arvo}} - Nimetty arvo</span>
    </div>
</script>

<!-- NIMETTY TOTUUSARVO -->
<script type="text/ng-template" id="nimetty_totuusarvo.html">
    <div class="frame">
        <span class="icon">&#8302;</span>
        <span class="label"
              ng-click="kaavaInformationView(funktio, true)">{{funktio.syoteparametrit[0].arvo}} - Nimetty arvo</span>
    </div>
</script>

<!-- LUKUARVO -->
<script type="text/ng-template" id="lukuarvo.html">
    <div class="parameter" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, true)">
            <span class="label" ng-if="!funktio.syoteparametrit[0].arvo"
                  ng-click="kaavaInformationView(funktio, true)">Vakio {{funktio}}</span>
            <span class="label" ng-if="funktio.syoteparametrit[0].arvo" ng-click="kaavaInformationView(funktio, true)">{{funktio.syoteparametrit[0].arvo}}</span>
        </span>
    </div>
</script>

<!-- TOTUUSARVO -->
<script type="text/ng-template" id="totuusarvo.html">
    <div class="parameter" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, true)">
            <span ng-if="!funktio.syoteparametrit[0].arvo">Totuusarvo</span>
            <span class="label" ng-if="funktio.syoteparametrit[0].arvo !== undefined"
                  ng-click="kaavaInformationView(funktio, true)">{{funktio.syoteparametrit[0].arvo}}</span>
        </span>
    </div>
</script>

<!-- HAKUTOIVE -->
<script type="text/ng-template" id="hakutoive.html">
    <div class="parameter" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, true)">
            <span ng-if="funktio.syoteparametrit[0].arvo">{{funktio.syoteparametrit[0].arvo}}. hakutoive</span>
            <span ng-if="!funktio.syoteparametrit[0].arvo">Hakutoive</span>
        </span>
    </div>
</script>

<!-- DEMOGRAFIA -->
<script type="text/ng-template" id="demografia.html">
    <div class="parameter" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, true)">Demografia</span>
    </div>
</script>

<!-- HYLKÄÄ ARVOVÄLILLÄ -->
<script type="text/ng-template" id="hylkaa_arvovalilla.html">
    <div class="function" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, true)">
        <span>Hylkää arvovälillä: </span>
        <span ng-if="funktio.syoteparametrit[1].arvo">{{funktio.syoteparametrit[1].arvo}}</span>
        <span ng-if="!funktio.syoteparametrit[1].arvo">?</span>
        <span> - </span>
        <span ng-if="funktio.syoteparametrit[2].arvo">{{funktio.syoteparametrit[2].arvo}}</span>
        <span ng-if="!funktio.syoteparametrit[2].arvo">?</span>
        <span ng-if="funktio.syoteparametrit[0].arvo"> ({{funktio.syoteparametrit[0].arvo}})</span>
    </div>
</script>

<!-- SUMMA -->
<script type="text/ng-template" id="summa.html">
    <div class="function" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon sum">&#8302;</span>
        <span class="label" ng-click="kaavaInformationView(funktio, true)">Summa</span>
    </div>
</script>


<!-- 
TAI
TULO
JOS
OSAMAARA
SUUREMPI
SKAALAUS 
PYORISTYS
PAINOTETTUKESKIARVO
HYLKAA
KONVERTOILUKUARVO
KESKIARVO
NEGAATIO
MINIMI
MAKSIMI
JA
EI
SUUREMPITAIYHTASUURI
PIENEMPITAIYHTASUURI
MEDIAANI
PIENEMPI
YHTASUURI
-->
<script type="text/ng-template" id="funktio.html">
    <div class="function" ng-class="funktioSelection == funktio ? 'active' : ''">
        <span class="icon">&#8302;</span>

        <span class="label" ng-if="funktio.funktionimi == 'TULO'" ng-click="kaavaInformationView(funktio, true)">Tulo</span>
        <span class="label" ng-if="funktio.funktionimi == 'JOS'" ng-click="kaavaInformationView(funktio, true)">Jos</span>
        <span class="label" ng-if="funktio.funktionimi == 'OSAMAARA'" ng-click="kaavaInformationView(funktio, true)">Osamäärä</span>
        <span class="label" ng-if="funktio.funktionimi == 'SUUREMPI'" ng-click="kaavaInformationView(funktio, true)">Suurempi</span>
        <span class="label" ng-if="funktio.funktionimi == 'YHTASUURI'" ng-click="kaavaInformationView(funktio, true)">Yhtäsuuri</span>
        <span class="label" ng-if="funktio.funktionimi == 'TAI'" ng-click="kaavaInformationView(funktio, true)">Tai</span>
        <span class="label" ng-if="funktio.funktionimi == 'PIENEMPI'" ng-click="kaavaInformationView(funktio, true)">Pienempi</span>
        <span class="label" ng-if="funktio.funktionimi == 'MEDIAANI'" ng-click="kaavaInformationView(funktio, true)">Mediaani</span>
        <span class="label" ng-if="funktio.funktionimi == 'PIENEMPITAIYHTASUURI'" ng-click="kaavaInformationView(funktio, true)">Pienempi tai yhtäsuuri</span>
        <span class="label" ng-if="funktio.funktionimi == 'SUUREMPITAIYHTASUURI'" ng-click="kaavaInformationView(funktio, true)">Suurempi tai yhtäsuuri</span>
        <span class="label" ng-if="funktio.funktionimi == 'EI'" ng-click="kaavaInformationView(funktio, true)">Ei</span>
        <span class="label" ng-if="funktio.funktionimi == 'JA'" ng-click="kaavaInformationView(funktio, true)">Ja</span>
        <span class="label" ng-if="funktio.funktionimi == 'MAKSIMI'" ng-click="kaavaInformationView(funktio, true)">Maksimi</span>
        <span class="label" ng-if="funktio.funktionimi == 'MINIMI'" ng-click="kaavaInformationView(funktio, true)">Minimi</span>
        <span class="label" ng-if="funktio.funktionimi == 'NEGAATIO'" ng-click="kaavaInformationView(funktio, true)">Negaatio</span>
        <span class="label" ng-if="funktio.funktionimi == 'KESKIARVO'" ng-click="kaavaInformationView(funktio, true)">Keskiarvo</span>
        <span class="label" ng-if="funktio.funktionimi == 'KONVERTOILUKUARVO'" ng-click="kaavaInformationView(funktio, true)">Lukuarvon konversio</span>
        <span class="label" ng-if="funktio.funktionimi == 'HYLKAA'" ng-click="kaavaInformationView(funktio, true)">Hylkää</span>
        <span class="label" ng-if="funktio.funktionimi == 'PYORISTYS'" ng-click="kaavaInformationView(funktio, true)">Pyöristys</span>
        <span class="label" ng-if="funktio.funktionimi == 'SKAALAUS'" ng-click="kaavaInformationView(funktio, true)">Skaalaus</span>
        <span class="label" ng-if="funktio.funktionimi == 'PAINOTETTUKESKIARVO'" ng-click="kaavaInformationView(funktio, true)">Painotettu keskiarvo</span>
    </div>
</script>
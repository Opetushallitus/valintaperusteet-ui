<!-- Node template -->
<script type="text/ng-template" id="node.html">

    <span class="node" ng-if="puuNode.nimi">
        <i class="fa fa-users valintaryhma"
           ng-click="valintaryhmaPuu.expandNode(puuNode)"></i>
        <input type="radio" ng-model="selection.node" ng-change="changeSelection(puuNode)" id="{{puuNode.oid}}" ng-value="puuNode" name="puunode" /> <label for="{{puuNode.oid}}">{{puuNode.nimi}}</label>
    </span>

    <ol ng-if="puuNode.isVisible">
        <li ng-repeat="puuNode in puuNode.alavalintaryhmat | orderBy:'nimi'"
            ng-include="'node.html'">
        </li>
        <li ng-repeat="puuNode in puuNode.hakukohdeViitteet | orderBy:predicate"
            data-oid="{{puuNode.oid}}"
            ng-include="'hakukohde_leaf.html'">
        </li>
    </ol>

</script>

<!--Leaf template -->

<script type="text/ng-template" id="hakukohde_leaf.html">
    <div class="node">
        <i class="fa fa-building-o margin-right-1"></i><input class="margin-right-1" ng-model="selection.node" ng-change="changeSelection(puuNode)" name="puunode" type="radio" id="{{puuNode.oid}}" value="{{puuNode.oid}}"/><label
            for="{{puuNode.oid}}">{{puuNode.nimi}}</label>
    </div>
</script>

<div ng-controller="ValintaryhmaPuuValitsinController">

    <label class="control-label" for="haku">{{ t('valintaryhmatlistaus.haku') || 'Haku' }}</label>

    <div class="row">
        <div class="col-md-12">
            <!-- Show all hakus -->
            <select auth ng-if="!userModel.isKKUser" id="haku" class="form-control"
                    ng-model="hakuModel.haku"
                    ng-options="haku.uiNimi for haku in hakuModel.haut | CustomHakuFilter | orderBy:'nimi.kieli_fi'"
                    ng-change="changeHaku()">
                <option value=""></option>
            </select>

            <!-- For KKUser filter out all other than KKHaut-->
            <select auth ng-if="userModel.isKKUser" id="haku" class="form-control"
                    ng-model="hakuModel.haku"
                    ng-options="haku.uiNimi for haku in hakuModel.haut | CustomHakuFilter | kkHakuFilter | orderBy:'nimi.kieli_fi'"
                    ng-change="changeHaku()">
                <option value=""></option>
            </select>
            <button ng-click="showLimiters = !showLimiters" class="btn btn-default btn-sm margin-vertical-2"><i
                    ng-class="showLimiters ? 'fa fa-eye-slash' : 'fa fa-eye'"></i> {{t('hakulista.rajaa') || 'Rajaa
                hakuja'}}
            </button>
        </div>
    </div>

    <div collapse="!showLimiters" class="margin-top-2">
        <div class="form-horizontal col-md-12">

            <div class="form-group">
                <label class="col-md-2 control-label" for="hakuvuosi">{{t('hakulista.hakuvuosi') ||
                    'Hakuvuosi'}}</label>

                <div class="col-md-10">
                    <select class="form-control input-sm"
                            id="hakuvuosi"
                            ng-model="customHakuUtil.hakuvuosi.value"
                            ng-options="hakuvuosi for hakuvuosi in customHakuUtil.hakuvuodetOpts">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-md-2 control-label" for="hakukausi">{{t('hakulista.hakukausi') ||
                    'Hakukausi'}}</label>

                <div class="col-md-10">
                    <select class="form-control input-sm"
                            id="hakukausi"
                            ng-model="customHakuUtil.hakukausi.value"
                            ng-options="hakukausi.koodiUri as hakukausi.nimi for hakukausi in customHakuUtil.hakukausiOpts"
                            placeholder="Hakukausi">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-md-2 control-label" for="hakutapa">{{t('hakulista.hakutapa') || 'Hakutapa'}}</label>

                <div class="col-md-10">
                    <select class="form-control input-sm"
                            id="hakutapa"
                            ng-model="customHakuUtil.hakutapa.value"
                            ng-options="hakutapa.koodiUri as hakutapa.nimi for hakutapa in customHakuUtil.hakutapaOpts">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2" for="kohdejoukko">{{t('hakulista.kohdejoukko') ||
                    'Kohdejoukko'}}</label>

                <div class="col-md-10">
                    <select class="form-control input-sm"
                            id="kohdejoukko"
                            ng-model="customHakuUtil.kohdejoukko.value"
                            ng-options="kohdejoukko.koodiUri as kohdejoukko.nimi for kohdejoukko in customHakuUtil.kohdejoukkoOpts">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2" for="hakutyyppi">{{t('hakulista.hakutyyppi') ||
                    'Hakutyyppi'}}</label>

                <div class="col-md-10">
                    <select class="form-control input-sm"
                            id="hakutyyppi"
                            ng-model="customHakuUtil.hakutyyppi.value"
                            ng-options="hakutyyppi.koodiUri as hakutyyppi.nimi for hakutyyppi in customHakuUtil.hakutyyppiOpts">
                        <option></option>
                    </select>
                </div>
            </div>

        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-4"></label>
        <div class="col-sm-8">
            <button class="btn btn-sm btn-default margin-bottom-2" ng-click="valintaryhmaPuu.expandTree()"> <i class="fa fa-expand"></i> {{t('valintaryhmaselector.avaa') || 'Avaa puu' }}</button>
        </div>
    </div>

    <div class="valintaryhmaSelector">
        <ol class="treelist collapsible">
            <li>
                <span class="node">
                <i class="fa fa-users valintaryhma auki"></i>
                <input name="valintaryhmaOid" type="radio" ng-model="selection.node" name="puunode" value="" id="root"/> <label
                        for="root">{{ t('valintaryhmaselector.juuri') || 'Juuri' }}</label>
                </span>
            </li>
            <ol>
                <li ng-repeat="puuNode in valintaryhmaPuu.valintaperusteList | orderBy:'nimi'"
                    ng-model="puuNode"
                    class="{{addClass('uiExpanded',valintaryhmaPuu.isExpanded(puuNode))}} {{addClass('uiCollapsed',valintaryhmaPuu.isCollapsed(puuNode))}}"
                    ng-include="!valintaryhmaPuu.isHakukohde(puuNode) ? 'node.html' : 'hakukohde_leaf.html'">
                </li>
            </ol>
        </ol>
    </div>
</div>
